<!DOCTYPE html>
<html lang="en" class="transition-colors duration-200">

<head>
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.classList.toggle('dark', theme === 'dark');
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Movies | Next-Scene</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mobile footer padding to prevent content overlap */
        
        @media (max-width: 640px) {
            body {
                padding-bottom: 80px;
                padding-top: 60px;
            }
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 dark:text-white">

    <!-- Desktop Header / NAVBAR -->
    <header class="hidden sm:flex bg-white dark:bg-gray-800 py-4 border-b border-gray-200 dark:border-gray-700 transition-colors">
        <div class="max-w-7xl mx-auto px-4 w-full flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-film text-gray-800 dark:text-gray-200 text-3xl transition-colors"></i>
                <a href="index.html" id="logo-link" class="text-gray-900 dark:text-white text-lg font-bold transition-colors">Next-scene</a>
            </div>

            <!-- Navigation Links -->
            <nav class="flex gap-8 items-center" id="main-nav">
                <a href="index.html" class="text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors">Home</a>
                <a href="dashboard-page.html" class="text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors">Dashboard</a>
                <a href="watchlist-page.html" class="text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors">My
                    Watchlist</a>
                <a href="browse.html" class="text-black dark:text-white font-semibold transition-colors">Browse</a>
                <a href="about-page.html" class="text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors">About
                    us</a>
            </nav>

            <!-- Search Bar, Theme Toggle, Sign In Button, and Avatar (Desktop Only) - All in one line -->
            <div class="flex items-center gap-4 flex-shrink-0">
                <div class="relative max-w-xs w-full">
                    <input type="text" placeholder="Search movies..." class="w-full px-4 py-2 pl-10 bg-gray-100 dark:bg-gray-700 dark:text-white dark:border-gray-600 rounded text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <!-- Theme Toggle Button -->
                <a href="signin-page.html" id="signin-nav-btn" class="bg-black dark:bg-white dark:text-black text-white px-4 py-2 rounded hover:bg-gray-800 dark:hover:bg-gray-200 transition whitespace-nowrap">Sign In</a>
                <a href="profile-page.html" id="user-profile-btn" class="hidden w-10 h-10 min-w-[2.5rem] min-h-[2.5rem] rounded-full bg-gray-800 dark:bg-gray-700 flex items-center justify-center hover:bg-gray-700 dark:hover:bg-gray-600 transition flex-shrink-0 ml-2">
                    <i class="fa-solid fa-user text-white text-sm"></i>
                </a>
                <button data-theme-toggle class="relative inline-flex items-center h-8 w-20 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 bg-gray-300 dark:bg-gray-700" title="Toggle theme">
                        <span data-toggle-track class="inline-flex items-center justify-center h-6 w-6 transform rounded-full bg-white shadow-lg transition-all duration-300 ease-in-out translate-x-1 dark:translate-x-7">
                            <span data-toggle-icon></span>
                        </span>
                    </button>
            </div>
        </div>
    </header>

    <!-- Mobile Header (sm:hidden) -->
    <header class="sm:hidden fixed top-0 left-0 right-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm z-50">
        <div class="flex justify-between items-center px-4 py-3">

            <i class="fa-solid fa-film text-gray-800 dark:text-white text-2xl"></i>
            <h1 class="text-lg font-semibold text-gray-900 dark:text-white">Browse</h1>

            <!-- Avatar (Link to Profile) -->
            <a href="profile-page.html" class="w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center">
                <i class="fa-solid fa-user text-gray-600 text-xs"></i>
            </a>
        </div>
    </header>




    <main class="max-w-7xl mx-auto px-4 py-6 md:py-8">

        <div class="hidden md:block mb-8">
            <h1 class="text-3xl font-bold mb-2 dark:text-white">Browse Movies</h1>
            <p class="text-gray-600 dark:text-gray-300">Discover and explore thousands of movies</p>
        </div>

        <div class="md:hidden mb-6">
            <h1 class="text-2xl font-bold mb-4 dark:text-white">Browse</h1>
            <div class="relative mb-4">
                <input type="text" id="mobile-search" placeholder="Search movies..." class="w-full px-4 py-3 pr-10 bg-white dark:bg-gray-700 dark:text-white border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-600">
                <button class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-300">
                        <i class="fas fa-search"></i>
                    </button>
            </div>
        </div>

        <div class="md:hidden mb-6 overflow-x-auto">
            <div class="flex gap-2 pb-2">
                <button class="px-4 py-2 bg-black dark:bg-white dark:text-black text-white rounded-full text-sm whitespace-nowrap font-medium">All</button>
                <button class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm whitespace-nowrap hover:bg-gray-50 dark:hover:bg-gray-700">Action</button>
                <button class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm whitespace-nowrap hover:bg-gray-50 dark:hover:bg-gray-700">Drama</button>
                <button class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm whitespace-nowrap hover:bg-gray-50 dark:hover:bg-gray-700">2024</button>
                <button class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm whitespace-nowrap hover:bg-gray-50 dark:hover:bg-gray-700">5+ ⭐</button>
            </div>
        </div>

        <div class="hidden md:block mb-6">
            <div class="flex items-center gap-4 mb-4">
                <div class="relative flex-1">
                    <input type="text" placeholder="Search movies, actors, directors..." class="w-full px-9 py-3 pr-10 bg-white dark:bg-gray-700 dark:text-white border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-600">
                    <button class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-300">
                            <i class="fas fa-search"></i>
                        </button>
                </div>
            </div>

            <div class="flex items-center justify-between">
                <div class="flex gap-3">
                    <select class="px-4 py-2 bg-white dark:bg-gray-700 dark:text-white border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-600">
                            <option>Genre</option>
                            <option>Action</option>
                            <option>Drama</option>
                            <option>Comedy</option>
                            <option>Thriller</option>
                        </select>
                    <select class="px-4 py-2 bg-white dark:bg-gray-700 dark:text-white border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-600">
                            <option>Year</option>
                            <option>2024</option>
                            <option>2023</option>
                            <option>2022</option>
                        </select>
                    <select class="px-4 py-2 bg-white dark:bg-gray-700 dark:text-white border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-600">
                            <option>Rating</option>
                            <option>9+ Stars</option>
                            <option>8+ Stars</option>
                            <option>7+ Stars</option>
                        </select>
                    <button class="px-4 py-2 text-gray-600 dark:text-gray-300 text-sm hover:text-black dark:hover:text-white flex items-center gap-2">
                            <i class="fas fa-times"></i> Clear Filters
                        </button>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-sm text-gray-600 dark:text-gray-300">Showing 1-24 • 1080</span>
                    <span class="text-gray-300 dark:text-gray-600">|</span>
                    <span class="text-sm text-gray-600 dark:text-gray-300">Sort by:</span>
                    <select class="px-3 py-1 bg-white dark:bg-gray-700 dark:text-white border border-gray-200 dark:border-gray-600 rounded text-sm focus:outline-none">
                            <option>Popularity</option>
                            <option>Rating</option>
                            <option>Year</option>
                        </select>
                </div>
            </div>
        </div>

        <!-- Desktop movies grid (populated dynamically from API) -->
        <div id="browse-grid-desktop" class="hidden md:grid grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4"></div>

        <!-- Mobile movies list (populated dynamically from API) -->
        <div id="browse-list-mobile" class="md:hidden space-y-4"></div>

    </main>

    <footer class="bg-black text-white py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <i class="fa-solid fa-film text-white text-2xl"></i>
                        <span class="text-white text-lg font-bold">Next-scene</span>
                    </div>
                    <p class="text-gray-400 text-xs">Your ultimate destination for movie discovery and management.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Product</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li><a href="#" class="hover:text-white">Features</a></li>
                        <li><a href="#" class="hover:text-white">Pricing</a></li>
                        <li><a href="#" class="hover:text-white">API</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Company</h4>
                    <ul class="text-gray-400 text-sm space-y-2">
                        <li><a href="#" class="hover:text-white">About</a></li>
                        <li><a href="#" class="hover:text-white">Blog</a></li>
                        <li><a href="#" class="hover:text-white">Careers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Connect</h4>
                    <div class="flex gap-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-8 text-center text-gray-400 text-sm">
                <p>© 2025 Next-scene. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Mobile Footer Navigation (sm:hidden) -->
    <nav class="sm:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50">
        <div class="flex justify-around items-center py-3">
            <!-- Home -->
            <a href="index.html" class="flex flex-col items-center gap-1 text-gray-600 dark:text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
                <span class="text-xs">Home</span>
            </a>

            <!-- Browse -->
            <a href="Browse.html" class="flex flex-col items-center gap-1 text-gray-900 dark:text-white font-bold">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
                <span class="text-xs">Browse</span>
            </a>

            <!-- Dashboard (Active) -->
            <a href="dashboard-page.html" class="flex flex-col items-center gap-1 text-gray-600 dark:text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
                <span class="text-xs">Dashboard</span>
            </a>

            <!-- Profile -->
            <a href="profile-page.html" class="flex flex-col items-center gap-1 text-gray-600 dark:text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
                <span class="text-xs">Profile</span>
            </a>
        </div>
    </nav>

    <script type="module" src="/src/main.jsx"></script>
    <script src="/public/theme.js"></script>
    <script src="src/watchlist.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const signinBtn = document.getElementById('signin-nav-btn');
            const profileBtn = document.getElementById('user-profile-btn');
            const signinBtnMobile = document.getElementById('signin-nav-btn-mobile');
            const profileBtnMobile = document.getElementById('user-profile-btn-mobile');
            const mainNav = document.getElementById('main-nav');
            const logoLink = document.getElementById('logo-link');
            const mobileNav = document.querySelector('.sm\\:hidden.fixed.bottom-0');
            const user = localStorage.getItem('user');

            let isAdmin = false;

            if (user) {
                try {
                    const userData = JSON.parse(user);
                    isAdmin = userData.role === 'admin';
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }

                // user is signed in and hide the sign-in button
                if (signinBtn) {
                    signinBtn.style.display = 'none';
                }
                if (signinBtnMobile) {
                    signinBtnMobile.style.display = 'none';
                }
                if (profileBtn) {
                    profileBtn.classList.remove('hidden');
                }
                if (profileBtnMobile) {
                    profileBtnMobile.classList.remove('hidden');
                }

                // Update navigation for admin
                if (isAdmin && mainNav) {
                    mainNav.innerHTML = `
                        <a href="admin-dashboard.html" class="text-gray-700 hover:text-black">Admin Dashboard</a>
                        <a href="form-page.html" class="text-gray-700 hover:text-black">Add Movie</a>
                        <a href="browse.html" class="text-black font-semibold">Browse</a>
                    `;
                }

                // Update logo link for admin
                if (isAdmin && logoLink) {
                    logoLink.href = 'admin-dashboard.html';
                }

                // Hide theme toggle for admin users
                if (isAdmin) {
                    const themeToggleBtn = document.getElementById('theme-toggle-btn') || document.querySelector('[data-theme-toggle]');
                    if (themeToggleBtn) {
                        themeToggleBtn.style.display = 'none';
                    }
                }

                // Update mobile navigation for admin
                if (isAdmin && mobileNav) {
                    mobileNav.innerHTML = `
                        <div class="flex justify-around items-center py-3">
                            <a href="admin-dashboard.html" class="flex flex-col items-center gap-1 text-gray-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                                <span class="text-xs">Dashboard</span>
                            </a>
                            <a href="form-page.html" class="flex flex-col items-center gap-1 text-gray-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                </svg>
                                <span class="text-xs">Add Movie</span>
                            </a>
                            <a href="Browse.html" class="flex flex-col items-center gap-1 text-gray-900 font-bold">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <span class="text-xs">Browse</span>
                            </a>
                            <a href="profile-page.html" class="flex flex-col items-center gap-1 text-gray-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <span class="text-xs">Profile</span>
                            </a>
                        </div>
                    `;
                }
            } else {
                // user is not signed in and display the sign-in button
                if (signinBtn) {
                    signinBtn.style.display = 'block';
                }
                if (signinBtnMobile) {
                    signinBtnMobile.style.display = 'block';
                }
                if (profileBtn) {
                    profileBtn.classList.add('hidden');
                }
                if (profileBtnMobile) {
                    profileBtnMobile.classList.add('hidden');
                }
            }
        });
    </script>
    <script>
        // Simple client-side integration with the movies API
        // Adjust API_BASE_URL if your backend is hosted elsewhere.
        const API_BASE_URL = 'http://localhost:4000';

        async function loadMovies() {
            const desktopGrid = document.getElementById('browse-grid-desktop');
            const mobileList = document.getElementById('browse-list-mobile');

            if (!desktopGrid && !mobileList) return;

            try {
                const res = await fetch(API_BASE_URL + '/api/movies');
                if (!res.ok) {
                    throw new Error('Failed to fetch movies');
                }

                const movies = await res.json();

                // Clear existing content
                desktopGrid.innerHTML = '';
                mobileList.innerHTML = '';

                movies.forEach((movie) => {
                    const title = movie.title || 'Untitled';
                    const year = movie.releaseYear || '';
                    const rating = movie.rating != null ? movie.rating : '';
                    const poster = movie.poster || 'img/image1tst.png';
                    const genres = movie.genre || '';
                    const runtime = movie.runtime ? movie.runtime + ' min' : '';
                    const description = movie.description || '';
                    const shortDescription = description.length > 140 ? description.slice(0, 137) + '...' : description;
                    const movieId = movie._id;

                    // Check if movie is already in watchlist
                    const watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
                    const isInWatchlist = watchlist.some(m => m.id === movieId || m.title === title);
                    const bookmarkIcon = isInWatchlist ? 'fas fa-bookmark' : 'far fa-bookmark';

                    // Desktop card
                    if (desktopGrid) {
                        const card = document.createElement('a');
                        card.href = 'MovieDetails.html?id=' + encodeURIComponent(movieId);
                        card.innerHTML = `
                            <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition group cursor-pointer">
                                <div class="relative">
                                    <div class="w-full aspect-[2/3] bg-gray-300 flex items-center justify-center text-white text-sm">
                                        <img src="${poster}" alt="Movie Poster" class="absolute inset-0 w-full h-full object-cover" />
                                    </div>
                                    <button onclick="event.preventDefault(); event.stopPropagation(); addToWatchlistFromBrowse('${movieId}', '${title.replace(/'/g, "\\'")}', '${poster.replace(/'/g, "\\'")}', '${year}', this);" class="absolute top-2 right-2 w-8 h-8 bg-gray-800 bg-opacity-70 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition hover:bg-opacity-90 z-10">
                                        <i class="${bookmarkIcon} text-white text-sm"></i>
                                    </button>
                                </div>
                                <div class="p-3">
                                    <h3 class="font-semibold text-sm mb-1 truncate dark:text-white">${title}</h3>
                                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-2">${year}</p>
                                    <div class="flex items-center gap-1">
                                        <i class="fas fa-star text-yellow-500 text-xs"></i>
                                        <span class="text-gray-700 dark:text-gray-300 text-xs font-medium">${rating}</span>
                                    </div>
                                    <p class="text-gray-500 dark:text-gray-400 text-xs mt-1">${genres}</p>
                                </div>
                            </div>
                        `;
                        desktopGrid.appendChild(card);
                    }

                    // Mobile list item
                    if (mobileList) {
                        const item = document.createElement('a');
                        item.href = 'MovieDetails.html?id=' + encodeURIComponent(movieId);
                        item.innerHTML = `
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 flex gap-3 shadow-sm">
                                <div class="w-16 h-24 bg-gray-300 rounded flex-shrink-0 flex items-center justify-center text-white text-xs">
                                    <img src="${poster}" alt="Movie Poster" class="inset-0 w-16 h-24 object-cover rounded flex-shrink-0 flex items-center justify-center" />
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between mb-1">
                                        <h3 class="font-semibold text-sm">${title}</h3>
                                        <button onclick="event.preventDefault(); event.stopPropagation(); addToWatchlistFromBrowseMobile('${movieId}', '${title.replace(/'/g, "\\'")}', '${poster.replace(/'/g, "\\'")}', '${year}', this);" class="flex-shrink-0 ml-2 hover:text-gray-600 transition-colors z-10">
                                            <i class="${bookmarkIcon} text-gray-400"></i>
                                        </button>
                                    </div>
                                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-2">${year} • ${genres}</p>
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="flex items-center gap-1">
                                            <i class="fas fa-star text-yellow-500 text-xs"></i>
                                            <span class="text-gray-700 dark:text-gray-300 text-xs font-medium">${rating}</span>
                                        </div>
                                        <span class="text-gray-400 text-xs">${runtime}</span>
                                    </div>
                                    <p class="text-gray-600 text-xs line-clamp-2">${shortDescription}</p>
                                </div>
                            </div>
                        `;
                        mobileList.appendChild(item);
                    }
                });
            } catch (error) {
                console.error(error);
                if (desktopGrid) {
                    desktopGrid.innerHTML = '<p class="col-span-full text-center text-gray-500 dark:text-gray-400 text-sm">Failed to load movies.</p>';
                }
                if (mobileList) {
                    mobileList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 text-sm">Failed to load movies.</p>';
                }
            }
        }

        // Function to add movie to watchlist from browse page
        function addToWatchlistFromBrowse(movieId, title, poster, year, buttonElement) {
            const movie = {
                id: movieId,
                title: title,
                poster: poster,
                year: year,
                addedAt: new Date().toISOString()
            };

            let watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
            const existingIndex = watchlist.findIndex(m => m.id === movieId || m.title === title);

            if (existingIndex >= 0) {
                // Remove if exists (toggle behavior)
                watchlist.splice(existingIndex, 1);
                if (typeof showNotification === 'function') {
                    showNotification('Removed from Watchlist', 'error');
                } else {
                    console.log('Removed from Watchlist');
                }
                // Update icon to empty bookmark
                if (buttonElement) {
                    const icon = buttonElement.querySelector('i');
                    if (icon) {
                        icon.className = 'far fa-bookmark text-white text-sm';
                    }
                }
            } else {
                // Add new
                watchlist.push(movie);
                if (typeof showNotification === 'function') {
                    showNotification('Added to Watchlist', 'success');
                } else {
                    console.log('Added to Watchlist');
                }
                // Update icon to filled bookmark
                if (buttonElement) {
                    const icon = buttonElement.querySelector('i');
                    if (icon) {
                        icon.className = 'fas fa-bookmark text-white text-sm';
                    }
                }
            }

            localStorage.setItem('watchlist', JSON.stringify(watchlist));
        }
        
        // Function for mobile bookmark button
        function addToWatchlistFromBrowseMobile(movieId, title, poster, year, buttonElement) {
            const movie = {
                id: movieId,
                title: title,
                poster: poster,
                year: year,
                addedAt: new Date().toISOString()
            };

            let watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
            const existingIndex = watchlist.findIndex(m => m.id === movieId || m.title === title);

            if (existingIndex >= 0) {
                // Remove if exists (toggle behavior)
                watchlist.splice(existingIndex, 1);
                if (typeof showNotification === 'function') {
                    showNotification('Removed from Watchlist', 'error');
                }
                // Update icon to empty bookmark
                if (buttonElement) {
                    const icon = buttonElement.querySelector('i');
                    if (icon) {
                        icon.className = 'far fa-bookmark text-gray-400';
                    }
                }
            } else {
                // Add new
                watchlist.push(movie);
                if (typeof showNotification === 'function') {
                    showNotification('Added to Watchlist', 'success');
                }
                // Update icon to filled bookmark
                if (buttonElement) {
                    const icon = buttonElement.querySelector('i');
                    if (icon) {
                        icon.className = 'fas fa-bookmark text-gray-400';
                    }
                }
            }

            localStorage.setItem('watchlist', JSON.stringify(watchlist));
        }

        document.addEventListener('DOMContentLoaded', loadMovies);
    </script>
    <script src="page-transition.js"></script>

</body>

</html>